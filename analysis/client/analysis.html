<template name="analysis">
    {{#with funnel}}
        <div class="pull-right">
            <a href="#" class="btn btn-danger btn-xs rebuild"><i class="fa fa-database"></i> Rebuild data</a>
            {{#afModal class="btn btn-info btn-xs" collection="Funnels" operation="update" doc=_id}}
                <i class="fa fa-pencil"></i> Edit funnel
            {{/afModal}}
            <a href="#" class="btn btn-info btn-xs viewquery" data-toggle="modal" data-target=".query-modal"><i class="fa fa-eye"></i> View query</a>
        </div>
        <div class="jumbotron">
            <h1>{{funnel.name}}</h1>
            <p>{{funnel.description}}</p>
        </div>
        <div id="sidebar-container" class="col-md-3">
            <div id="sidebar">
                {{> facets}}
            </div>
        </div>
        <div class="col-md-9">
            {{#each funnel.steps}}
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <h3 class="panel-title">Entered {{name}}</h3>
                    </div>
                    <div class="panel-body">
                        {{> chart name=name step=@index}}
                    </div>
                </div>
            {{/each}}
            <div class="modal fade query-modal" tabindex="-1" role="dialog" aria-labelledby="querymodal">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                             <h4 class="modal-title" id="querymodal">Query</h4>
                        </div>
                        <div class="modal-body">
                            {{> query}}
                        </div>
                    </div>
                </div>
            </div>
            {{> autoformModals}}
        </div>
    {{/with}}
</template>
