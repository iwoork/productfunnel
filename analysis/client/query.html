<template name="query">
<pre>
SELECT
    {{fields}},
    '{{key}}' as key,
    {{steps}}
FROM
    (SELECT
        {{fields}},
        visit_ID,
        {{progression}}
    FROM
        (SELECT
            {{fields}},
            CONCAT(visitor_id, visit_number) as visit_ID,
            {{values}}
        FROM
            {{source}}
        WHERE
            {{conditions}}
        GROUP BY
            CONCAT(visitor_id, visit_number),
            {{groups}}
        ) i
    GROUP BY
        visit_ID,
        {{groups}}
    ) o
GROUP BY
    {{groups}}
</pre>
</template>
